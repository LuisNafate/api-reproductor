# Arquitectura del Proyecto - Music Player API

## ๐ Diagrama de Capas

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     CAPA DE PRESENTACIรN                     โ
โ                                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              Routes (Endpoints REST)                  โ  โ
โ  โ  - ArtistRoutes.kt                                   โ  โ
โ  โ  - AlbumRoutes.kt                                    โ  โ
โ  โ  - SongRoutes.kt                                     โ  โ
โ  โ  - PlaylistRoutes.kt                                 โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                             โ                                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                    DTOs                               โ  โ
โ  โ  - Request DTOs (ArtistRequest, SongRequest, etc.)   โ  โ
โ  โ  - Response DTOs (ArtistResponse, ErrorResponse)     โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE NEGOCIO                         โ
โ                                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                    Services                           โ  โ
โ  โ  - ArtistService                                     โ  โ
โ  โ  - AlbumService                                      โ  โ
โ  โ  - SongService                                       โ  โ
โ  โ  - PlaylistService                                   โ  โ
โ  โ                                                       โ  โ
โ  โ  Responsabilidades:                                  โ  โ
โ  โ  โข Lรณgica de negocio                                 โ  โ
โ  โ  โข Validaciones                                      โ  โ
โ  โ  โข Transformaciรณn DTO โ Domain                       โ  โ
โ  โ  โข Orquestaciรณn de repositorios                      โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       CAPA DE DATOS                          โ
โ                                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              Repository Interfaces                    โ  โ
โ  โ  - ArtistRepository                                  โ  โ
โ  โ  - AlbumRepository                                   โ  โ
โ  โ  - SongRepository                                    โ  โ
โ  โ  - PlaylistRepository                                โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                             โ                                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ           Repository Implementations                  โ  โ
โ  โ  - ArtistRepositoryImpl                              โ  โ
โ  โ  - AlbumRepositoryImpl                               โ  โ
โ  โ  - SongRepositoryImpl                                โ  โ
โ  โ  - PlaylistRepositoryImpl                            โ  โ
โ  โ                                                       โ  โ
โ  โ  Responsabilidades:                                  โ  โ
โ  โ  โข Acceso a base de datos                            โ  โ
โ  โ  โข Queries con Exposed ORM                           โ  โ
โ  โ  โข Transformaciรณn Row โ Domain                       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      CAPA DE DOMINIO                         โ
โ                                                              โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                  Domain Models                        โ  โ
โ  โ  - Artist                                            โ  โ
โ  โ  - Album                                             โ  โ
โ  โ  - Song                                              โ  โ
โ  โ  - Playlist                                          โ  โ
โ  โ  - PlaylistSong                                      โ  โ
โ  โ                                                       โ  โ
โ  โ  Entidades de negocio puras (sin dependencias)       โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                             โ                                โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              Database Tables (Exposed)                โ  โ
โ  โ  - ArtistsTable                                      โ  โ
โ  โ  - AlbumsTable                                       โ  โ
โ  โ  - SongsTable                                        โ  โ
โ  โ  - PlaylistsTable                                    โ  โ
โ  โ  - PlaylistSongsTable                                โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                              โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      BASE DE DATOS                           โ
โ                                                              โ
โ              PostgreSQL / H2 (testing)                       โ
โ                                                              โ
โ  Tables:                                                     โ
โ  โข artists                                                   โ
โ  โข albums                                                    โ
โ  โข songs                                                     โ
โ  โข playlists                                                 โ
โ  โข playlist_songs                                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    CAPA DE CONFIGURACIรN                     โ
โ                                                              โ
โ  โข DatabaseFactory - Conexiรณn y pool de BD                   โ
โ  โข StatusPages - Manejo de errores global                   โ
โ  โข CORS - Configuraciรณn de CORS                             โ
โ  โข Logging - Logging de requests                            โ
โ  โข Security - JWT Auth (preparado para futuro)              โ
โ  โข Serialization - Jackson JSON                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ Flujo de una Request

```
1. HTTP Request
   โ
   โผ
2. Ktor Server (Application.kt)
   โ
   โผ
3. Middleware Pipeline
   โโโ CORS
   โโโ Logging
   โโโ Content Negotiation (Jackson)
   โโโ Status Pages (Error Handling)
   โ
   โผ
4. Routes (presentation/routes)
   โ
   โโโ Validaciรณn de parรกmetros
   โโโ Parsing de Request Body
   โ
   โผ
5. Service (service/)
   โ
   โโโ Lรณgica de negocio
   โโโ Validaciones adicionales
   โโโ Transformaciรณn DTO โ Domain
   โ
   โผ
6. Repository (data/repositories)
   โ
   โโโ Query con Exposed ORM
   โโโ Transformaciรณn Row โ Domain
   โ
   โผ
7. Database (PostgreSQL)
   โ
   โผ
8. Response Flow (inverso)
   โ
   โโโ Domain Model
   โโโ Service transforma a DTO
   โโโ Jackson serializa a JSON
   โโโ HTTP Response
```

## ๐ฏ Ventajas de esta Arquitectura

### โ Separaciรณn de Responsabilidades
Cada capa tiene una responsabilidad clara y especรญfica.

### โ Testabilidad
Las interfaces de repositorio permiten fรกcil mocking para tests.

### โ Mantenibilidad
Cambios en una capa no afectan directamente a las otras.

### โ Escalabilidad
Fรกcil agregar nuevas entidades siguiendo el mismo patrรณn.

### โ Reutilizaciรณn
La lรณgica de negocio en servicios puede reutilizarse.

### โ Flexibilidad
Cambiar la base de datos solo requiere modificar la capa de datos.

## ๐ Relaciones entre Entidades

```
โโโโโโโโโโโโ       โโโโโโโโโโโโ       โโโโโโโโโโโโ
โ  Artist  โโโโโฌโโโถโ  Album   โโโโโฌโโโถโ   Song   โ
โโโโโโโโโโโโ   โ   โโโโโโโโโโโโ   โ   โโโโโโโโโโโโ
               โ                  โ         โ
               โ                  โ         โ
            1:N relationship   1:N rel.     โ
                                            โ
                                         N:M rel.
                                            โ
                                            โผ
                                    โโโโโโโโโโโโโโโ
                                    โ  Playlist   โ
                                    โโโโโโโโโโโโโโโ
                                          โ
                                       through
                                          โ
                                          โผ
                                  โโโโโโโโโโโโโโโโ
                                  โPlaylistSongs โ
                                  โโโโโโโโโโโโโโโโ
```

## ๐ง Patrones Implementados

1. **Repository Pattern**: Abstracciรณn del acceso a datos
2. **Service Layer Pattern**: Lรณgica de negocio centralizada
3. **DTO Pattern**: Separaciรณn de concerns en representaciรณn
4. **Factory Pattern**: DatabaseFactory para configuraciรณn
5. **Dependency Injection**: Manual, preparado para DI framework
6. **Strategy Pattern**: Diferentes implementaciones de repos
